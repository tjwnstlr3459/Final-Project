<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="board">
<!-- 회원이 속한 클럽 출력 -->
<select id="selectBoardList" resultType="bl">
SELECT
	AB_NO AS abNo,
	ab_cg as abCg,
	ab_writer as abWriter,
	ab_Title as abTitle,
	ab_content as abContent,
	fileName,
	filePath,
	enroll_date as enrollDate
FROM BOARD
</select>

<!-- 공지게시물 10개 단위로 게시물 가져오기 -->
<select id="selectBoardListBetween" parameterType="map" resultType="bl">
	SELECT
	    AB_NO AS abNo,
		ab_cg as abCg,
		ab_writer as abWriter,
		ab_Title as abTitle,
		ab_content as abContent,
		fileName,
		filePath,
		enroll_date as enrollDate,
		selCount,
		status,
		(select cg_name from category where cg_no = ab_cg) as cgName
	FROM
	(SELECT rOWNUM AS RNUM, N.*FROM
	(SELECT * FROM BOARD where 
	<choose>
	<when test="type eq 1">
		ab_cg = 14
	</when>
	<otherwise>
		not ab_cg = 14
	</otherwise>
	</choose>
	ORDER BY AB_NO DESC)N) WHERE RNUM BETWEEN #{start} AND #{end}
</select>

<!-- 공지게시물의 총갯수 -->
<select id="totalCount" parameterType="map" resultType="int">
	SELECT count(*) FROM BOARD where
	<choose>
	<when test="type eq 1">
		ab_cg = 14
	</when>
	<otherwise>
		not ab_cg = 14
	</otherwise>
	</choose>
</select>
<!-- 공지상세보기 -->
<select id="selectBaord" parameterType="int" resultType="bl">
	SELECT 
		AB_NO AS abNo,
		ab_cg as abCg,
		ab_writer as abWriter,
		ab_Title as abTitle,
		ab_content as abContent,
		fileName,
		filePath,
		enroll_Date as enrollDate,
		selCount
	FROM BOARD WHERE AB_NO=#{abNo}
</select>

<!-- 공지/문의/쪽지 등록 -->
<insert id="insertBoard" parameterType="bl">
	INSERT INTO BOARD VALUES(
		AB_SEQ.NEXTVAL,
		#{abCg},
		#{abWriter},
		#{abTitle},
		#{abContent},
		#{fileName},
		#{filePath},
		to_char(sysdate,'yyyy-mm-dd'),
		'N',
		#{selCount})
</insert>

<!-- 최신공지게시물 출력 -->
<select id="selectLastBoard" resultType="int">
	SELECT MAX(AB_NO) FROM BOARD
</select>

<!-- 첨부파일 등록 -->
<update id="insertBoardFile" parameterType="bl">
	UPDATE BOARD SET
		filename  = #{fileName},
		filepath  = #{filePath}
	WHERE AB_NO = #{abNo}
</update>

<!-- 공지사항 삭제 -->
<delete id="deleteBoard" parameterType="int">
	delete from board where ab_no=#{abNo}
</delete>

<!-- 공지사항 수정 -->
<update id="boardUpdate" parameterType="bl">
	UPDATE BOARD SET 
		ab_Title=#{abTitle},
		ab_content=#{abContent}, 
		filename=#{fileName},
		filepath=#{filePath}
	where ab_no=#{abNo}
</update>

<!-- 조회수 업데이트 -->
<update id="updateCount" parameterType="int">
	update board set selCount= selCount+1 where ab_no=#{abNo}
</update>

<!-- 공지댓글 삭제 -->
<delete id="mentDelete" parameterType="int">
DELETE FROM ANSWER WHERE AN_NO=#{anNo}
</delete>

<!-- 공지 댓글 수정 -->
<update id="mentModify" parameterType="map">
UPDATE ANSWER SET 
	AN_CONTENT = #{mentUpdate} 
WHERE AN_NO = #{anNo}
</update>
<!-- 문의/신고 답변상태 변경 -->
<update id="updateBoardStatus" parameterType="an">
	update board set status='Y' where ab_no = #{abNo}
</update>

<!-- 마이페이지용 문의/신고 게시글 조회 -->
<select id="selectMyBoard" parameterType="map" resultType="bl">
select rownum, bs.* from 
	(select rownum as b_no_desc, b.* from 
		(select 
			AB_NO AS abNo,
			ab_cg as abCg,
			ab_writer as abWriter,
			ab_Title as abTitle,
			ab_content as abContent,
			fileName,
			filePath,
			enroll_date as enrollDate 
		from board where ab_cg=#{category} and ab_writer=#{memberNick} order by ab_no desc) b
 	) bs
where b_no_desc between #{start} and #{end}
</select>

<!-- 마이페이지용 문의/신고 게시글 수 -->
<select id="selectMyBoardCount" parameterType="map" resultType="int">
	select count(*) from (select * from board where ab_cg=#{category} and ab_writer=#{memberNick})
</select>
</mapper>





















